title: I/O复用
author: Jiahao Wu
tags:
  - IO复用
  - 操作系统
  - 网络编程
categories:
  - 操作系统
date: 2021-02-04 22:08:00
---
# I/O模型介绍

同步和异步、阻塞和非阻塞在I/O操作中总是容易分不清楚。  
I/O操作可以分为：发起I/O请求，执行I/O操作，得到I/O操作结果，返回结果。  

## 同步与异步  

同步和异步实际上是一种通信机制，涉及调用方和被调用方。  
**同步**：调用方等待被调用方完成操作然后返回结果；  
**异步**：调用方不需要等待调用方操作，而是被调用方自己操作完成后通知调用方。  
同步和异步适合用于描述I/O操作的执行部分。


## 阻塞与非阻塞

阻塞和非阻塞其实是一种调用机制，只涉及调用方，关注的是I/O操作的执行状态，不同点在于请求I/O操作后，针对I/O操作，被调用方的行为。  
如果调用方等待IO操作完成后返回，则是阻塞的；如果调用方不需要等待I/O操作完成就立即返回，则是非阻塞的，非阻塞的情况下，常常需要多次调用去检查，才能获得I/O操作的结果。

## I/O模型总结

1. 阻塞I/O  
当发生系统调用时候，比如recv，用户进程要一直等待到数据拷贝到用户空间，这段时间内进程始终阻塞。它是同步I/O。  
2. 非阻塞I/O  
还是以recv为例子，不管有没有数据都返回，如果没有数据，过一会再调用recv看看，如此循环。但是如果有数据，它要等待数据拷贝到用户空间，因此还是同步I/O。（相当于没有数据读的时候阻塞，读的时候还是非阻塞）  
3. I/O复用  
同时监听多个文件描述符，当有可读/可写/异常事件发生的时候，通知进程，进行读写或者处理异常。当没有事件发生时候，正常运行。就当前例子来看还是同步I/O，因为依旧要等待数据读完或者写完才能继续运行。I/O复用可用于同步I/O也可用于异步I/O。
4. 信号驱动的I/O模型  
通过调用sigaction注册信号函数，等内核数据准备好的时候，系统中断当前程序，执行信号函数（在这里调用recv）。这还是同步I/O。
5. 异步I/O模型  
调用aio_read，让内核等数据准本好，并且复制到用户进程空间后执行实现指定好的函数。这样子省去了进程等待读数据的事件。这是真正的异步I/O。
6. I/O的两个阶段  
内核数据的准备阶段和内核数据复制到用户缓冲区阶段。只有进程不用等待这两个阶段，才是真正的异步I/O。

