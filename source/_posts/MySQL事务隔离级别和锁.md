title: MySQL事务隔离级别和锁
author: Jiahao Wu
tags: []
categories:
  - MySQL学习
date: 2021-02-25 17:36:00
---
# 事务隔离级别

1. 可串行化；  
2. 可重复读，只允许读取已提交数据，而且在一个事务两次读取同一数据之间，其他事务不能更新该数据；    
3. 已提交读，只允许读取已经提交的数据；  
4. 未提交读，允许读取未提交的数据。  

以上隔离性级别都不允许脏写，即如果一个数据项已经被另一个尚未提交或终止的事务写入，则不允许对该数据项执行写操作。  

<table>
<tr>
    <th>隔离级别</th>
    <th>脏读</th>
    <th>不可重复读</th>
    <th>幻读</th>
</tr>
<tr>
    <td>未提交读</td>
    <td>可能</td>
    <td>可能</td>
    <td>可能</td>
</tr>
<tr>
    <td>已提交读</td>
    <td>不可能</td>
    <td>可能</td>
    <td>可能</td>
</tr>
<tr>
    <td>可重复读</td>
    <td>不可能</td>
    <td>不可能</td>
    <td>可能</td>
</tr>
<tr>
    <td>可串行化</td>
    <td>不可能</td>
    <td>不可能</td>
    <td>不可能</td>
</tr>
</table>


# 锁

DBMS中的并发控制的任务是确保在多个事务同时存取数据库中统一数据时不破坏事务的隔离性和一致性。常见的控制手段是乐观并发控制（乐观锁）和悲观并发控制（悲观锁）。  

## 悲观锁

假定会发生并发冲突，屏蔽一切可能违反数据完整性的操作。
使用方法：  
1. 对任意数据进行修改时，先尝试为该记录加上排他锁。  
2. 如果加锁失败就说明该记录正在被修改，等待锁被释放。  
3. 成功加锁后就可以对记录做修改，事务完成后就会解锁。  

悲观锁适用于数据竞争激烈的环境，以及发生并发冲突时使用锁保护数据的成本低于回滚事务的成本的环境中。

## 乐观锁

假定不会发生并发冲突，只在提交操作时检查是否违反了数据完整性。在提交数据更新之前，每个事务会先检查在该事务读取数据后，有没有其他事务又修改了该数据。如果其他事务有更新的话，正在提交的事务会进行回滚。  
使用方法：  
1. 在对数据库进行处理的时候，乐观锁并不会使用数据库提供的锁机制。一般的实现乐观锁的方式就是记录数据版本。  
2. 数据版本,为数据增加的一个版本标识。当读取数据时，将版本标识的值一同读出，数据每更新一次，同时对版本标识进行更新。
3. 当我们提交更新的时候，判断数据库表对应记录的当前版本信息与第一次取出来的版本标识进行比对，如果数据库表当前版本号与第一次取出来的版本标识值相等，则予以更新，否则认为是过期数据。


