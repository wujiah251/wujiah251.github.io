title: 一条SQL是如何执行的
author: 乡村程序员
tags:
  - 数据库系统
  - MySQL
categories:
  - 数据库系统概念
date: 2021-06-04 14:31:00

---

# 一条SQL是如何执行的

1. 客户端

   SQL语句首先再客户端创建。

2. 服务器：主要包括连接器、查询缓存、分析器、优化器、执行器等，

   - 连接器（负责管理身份认证和权限相关的，登录MySQL时会发挥作用）。
   - 查询缓存（SQL语句到达MySQL服务器后，会首先查询缓存，缓存命中后，返回结果）。
   - 分析器（SQL缓存未命中的话，SQL语句就会经过分析器，分析器就是分析SQL语句要做什么，再检查你的SQL语句语法是否正确）。
   - 优化器（可能你写的SQL语法没有问题，但是效率较低，比如没有很好地使用索引，这时候，优化器会对你的SQL语句进行优化）。
   - 执行器（执行语句，然后从存储引擎（InnoDB，MyISAM）返回数据）。

   

3. 存储引擎：主要负责数据的存储和读取，采用可以替换的插件式架构。（下面假设是update操作）

   - 执行器检查数据是否在缓冲池中，不再则从磁盘上加载，并对该数据加独占锁。
   - 将旧的数据写入到undo日志文件便于回滚。
   - 更新缓冲池中的数据。
   - 执行器更新数据写redo日志缓冲区。
   - redo日志写入磁盘，便于数据恢复。
   - 执行器写binlog日志。
   - redo日志写入binlog文件名称和位置，同时写入commit标记，提交事务。

   ![InnoDB执行流程](../images/%E4%B8%80%E6%9D%A1SQL%E6%98%AF%E5%A6%82%E4%BD%95%E6%89%A7%E8%A1%8C%E7%9A%84/20200715202612868.jpg)

