title: 多进程和多线程
author: Jiahao Wu
tags: []
categories:
  - 操作系统
date: 2021-03-11 08:46:00
---
# 多进程和多线程分析

最近面试的时候常常被问一个问题，多进程好还是多线程好？具体的使用场景是什么？笔者在这方面的知识储备不多也不够系统，所以在这里总结一下：  

## 多进程和多线程特性

<table>
  <tr>
  <th>属性</th>
  <th>多进程</th>
  <th>多线程</th>
  <th>总结</th>
  <tr>
  <td>数据同步</td>
  <td>数据共享复杂，需要使用IPC；数据是分开的，同步简单</td>
  <td>因为共享进程的内存，数据共享简单，但是同步复杂</td>
  <td>各有优势</td>
  <tr>
  <td>内存、CPU</td>
  <td>占用内存多，切换复杂，CPU利用率低</td>
  <td>占用内存少，切换简单，CPU利用率高</td>
  <td>线程占优</td>
  <tr>
  <td>创建销毁、切换</td>
  <td>创建、销毁、切换复杂，速度慢</td>
  <td>创建销毁、切换简单，速度很快</td>
  <td>线程占优</td>
  <tr>
  <td>编程、调试</td>
  <td>编程简单、调试简单</td>
  <td>编程复杂、调试复杂</td>
  <td>进程占优</td>
  <tr>
  <td>可靠性</td>
  <td>进程之间不会相互影响</td>
  <td>一个线程挂掉将导致整个进程挂掉</td>
  <td>进程占优</td>
  <tr>
  <td>分布式</td>
  <td>适应于多核、多机分布式系统，扩展机器比较简单</td>
  <td>适应于多核分布式</td>
  <td>进程占优</td>
</table>

## 不同场景下的选择

1. 需要频繁创建销毁的优先用线程：  
这种情况最常见的就是Web服务器了，来了一个连接建立一个线程，断了就销毁线程，要是用进程，创建和销毁的代价是很难承受的。  
2. 需要进行大量计算的优先使用线程：  
大量计算即CPU开销比较大，切换频繁了，这种情况下线程最合适。  
3. 强相关的处理用线程，弱相关的处理用进程：  
首先什么叫强相关，什么叫弱相关？举个例子，一般的server需要完成如下任务：消息收发、消息处理。这就叫弱相关的任务。而“消息处理”里面可能又分为“消息解码”、“业务处理”，这两个任务相对来说相关性就要强多了。因此“消息收发”和“消息处理”可以分进程设计，“消息解码”、“业务处理”可以分线程设计。  
4. 可能要扩展到多机分布的用进程，多核分布的用线程  
















