title: 用户态和内核态
author: Jiahao Wu
tags: []
categories:
  - 操作系统
date: 2021-02-19 20:39:00
---
操作系统维护着相当多的资源，而我们不能给每个进程以相同的权限，所以我们分出了内核态和用户态。用以区分进程能够访问的资源权限。  
# 划分

CPU有不同的指令执行级别，再高执行级别下，代码可以执行特权指令，访问任意的物理地址，这种CPU级别就对应着内核态。而在相应的低级别执行状态下，代码的掌握范围会受到限制。只能在对应级别允许的范围内活动。Intel X86CPU有四种不同的执行级别，Linux只是用了其中0和3级分别表示内核态和用户态


内核态和用户态之间的桥梁是系统调用，或者说系统调用将整个系统分为用户态和内核态。内核就是控制计算机的硬件资源，例如协调CPU资源，分配内存资源，并且提供稳定的环境供应用程序运行。 

用户态中和系统调用最近的就是库函数和shell。

库函数是为了封装系统调用的而存在的，将很多复杂操作封装起来，方便用户使用系统资源。比如可以通过open()来轻松打开文件，malloc()来分配内存，实际上，malloc()还是用了mmap()等系统调用。  
shell顾名思义，就是外壳的意思。就好像把内核包裹起来的外壳。它是一种特殊的应用程序，俗称命令行。为了方便用户和系统交互，一般一个shell对应一个终端，呈现给用户交互窗口。当然shell也是编程的，它有标准的shell语法，符合其语法的文本叫shell脚本。很多人都会用shell脚本实现一些常用的功能，可以提高工作效率。  

用户态和内核态切换的方法：  
1. 系统调用；  
2. 异常：发生异常后CPU会调用异常处理程序，触发切换，比如缺页异常；  
3. 外设中断：当外设完成用户的请求时，会向CPU发送中断信号。

